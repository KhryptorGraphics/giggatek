<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progressive Loading Example - GigGatek</title>
    <link rel="stylesheet" href="../css/main.css">
    <style>
        body {
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        
        .example-section {
            margin-bottom: 40px;
        }
        
        h1 {
            margin-bottom: 20px;
        }
        
        h2 {
            margin-bottom: 15px;
        }
        
        .btn {
            display: inline-block;
            padding: 0.375rem 0.75rem;
            border-radius: 0.25rem;
            font-size: 1rem;
            text-align: center;
            text-decoration: none;
            cursor: pointer;
            background-color: #0066cc;
            color: white;
            border: 1px solid transparent;
            margin-right: 10px;
        }
        
        .card {
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .card-body {
            padding: 1rem;
        }
        
        .card-title {
            margin-top: 0;
            margin-bottom: 0.5rem;
        }
        
        .card-text {
            margin-bottom: 1rem;
        }
        
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .lazy-image-container {
            position: relative;
            overflow: hidden;
            background-color: #f8f9fa;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
        }
        
        .lazy-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .lazy-image.loaded {
            opacity: 1;
        }
        
        .lazy-image-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
            transition: opacity 0.3s ease;
        }
        
        .lazy-image-placeholder.hidden {
            opacity: 0;
        }
        
        .progressive-image {
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .progressive-image-thumbnail {
            width: 100%;
            height: auto;
            filter: blur(10px);
            transform: scale(1.1);
            transition: opacity 0.3s ease;
            opacity: 1;
        }
        
        .progressive-image-full {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .progressive-image-full.loaded {
            opacity: 1;
        }
        
        .progressive-image-full.loaded + .progressive-image-thumbnail {
            opacity: 0;
        }
        
        .infinite-scroll-container {
            margin-bottom: 20px;
        }
        
        .item {
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
        }
        
        .pagination {
            display: flex;
            padding-left: 0;
            list-style: none;
            margin-bottom: 20px;
        }
        
        .pagination .page-item {
            margin-right: 5px;
        }
        
        .pagination .page-link {
            position: relative;
            display: block;
            padding: 0.5rem 0.75rem;
            line-height: 1.25;
            color: #0066cc;
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 0.25rem;
            text-decoration: none;
        }
        
        .pagination .page-item.active .page-link {
            z-index: 3;
            color: #fff;
            background-color: #0066cc;
            border-color: #0066cc;
        }
        
        .load-more {
            text-align: center;
            margin-bottom: 20px;
        }
        
        @keyframes skeleton-loading {
            0% {
                background-position: 200% 0;
            }
            100% {
                background-position: -200% 0;
            }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-to-content">Skip to main content</a>
    
    <main id="main-content">
        <h1>Progressive Loading Example</h1>
        
        <div class="example-section">
            <h2>Lazy Loading Images</h2>
            <p>Scroll down to see images load as they enter the viewport.</p>
            
            <div class="image-grid">
                <div class="lazy-image-container">
                    <img class="lazy-image" data-src="https://picsum.photos/id/1015/600/400" alt="Landscape 1">
                    <div class="lazy-image-placeholder"></div>
                </div>
                <div class="lazy-image-container">
                    <img class="lazy-image" data-src="https://picsum.photos/id/1016/600/400" alt="Landscape 2">
                    <div class="lazy-image-placeholder"></div>
                </div>
                <div class="lazy-image-container">
                    <img class="lazy-image" data-src="https://picsum.photos/id/1018/600/400" alt="Landscape 3">
                    <div class="lazy-image-placeholder"></div>
                </div>
                <div class="lazy-image-container">
                    <img class="lazy-image" data-src="https://picsum.photos/id/1019/600/400" alt="Landscape 4">
                    <div class="lazy-image-placeholder"></div>
                </div>
            </div>
        </div>
        
        <div class="example-section">
            <h2>Progressive Image Loading</h2>
            <p>Images load with a low-quality placeholder first, then the high-quality version.</p>
            
            <div class="progressive-image">
                <img class="progressive-image-full" data-src="https://picsum.photos/id/1039/1200/800" alt="Mountain landscape">
                <img class="progressive-image-thumbnail" src="https://picsum.photos/id/1039/30/20" alt="">
            </div>
            
            <div class="progressive-image">
                <img class="progressive-image-full" data-src="https://picsum.photos/id/1043/1200/800" alt="Forest landscape">
                <img class="progressive-image-thumbnail" src="https://picsum.photos/id/1043/30/20" alt="">
            </div>
        </div>
        
        <div class="example-section">
            <h2>Infinite Scroll</h2>
            <p>Scroll down to load more items automatically.</p>
            
            <div class="infinite-scroll-container" data-page="1" data-total-pages="5">
                <div class="item">
                    <h3>Item 1</h3>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam euismod, nisl eget aliquam ultricies, nunc nisl aliquet nunc, quis aliquam nisl nunc quis nisl.</p>
                </div>
                <div class="item">
                    <h3>Item 2</h3>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam euismod, nisl eget aliquam ultricies, nunc nisl aliquet nunc, quis aliquam nisl nunc quis nisl.</p>
                </div>
                <div class="item">
                    <h3>Item 3</h3>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam euismod, nisl eget aliquam ultricies, nunc nisl aliquet nunc, quis aliquam nisl nunc quis nisl.</p>
                </div>
                <div class="item">
                    <h3>Item 4</h3>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam euismod, nisl eget aliquam ultricies, nunc nisl aliquet nunc, quis aliquam nisl nunc quis nisl.</p>
                </div>
                <div class="item">
                    <h3>Item 5</h3>
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam euismod, nisl eget aliquam ultricies, nunc nisl aliquet nunc, quis aliquam nisl nunc quis nisl.</p>
                </div>
            </div>
        </div>
        
        <div class="example-section">
            <h2>Pagination to Load More</h2>
            <p>This example shows how to replace traditional pagination with a load more button.</p>
            
            <div class="pagination-container">
                <div class="items">
                    <div class="item">
                        <h3>Product 1</h3>
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam euismod, nisl eget aliquam ultricies, nunc nisl aliquet nunc, quis aliquam nisl nunc quis nisl.</p>
                    </div>
                    <div class="item">
                        <h3>Product 2</h3>
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam euismod, nisl eget aliquam ultricies, nunc nisl aliquet nunc, quis aliquam nisl nunc quis nisl.</p>
                    </div>
                    <div class="item">
                        <h3>Product 3</h3>
                        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam euismod, nisl eget aliquam ultricies, nunc nisl aliquet nunc, quis aliquam nisl nunc quis nisl.</p>
                    </div>
                </div>
                
                <nav aria-label="Page navigation">
                    <ul class="pagination">
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item"><a class="page-link" href="#">Next</a></li>
                    </ul>
                </nav>
            </div>
        </div>
        
        <div class="example-section">
            <h2>Skeleton Loading</h2>
            <p>This example shows skeleton loading placeholders while content is loading.</p>
            
            <div class="skeleton-container">
                <div class="skeleton-card">
                    <div class="skeleton-card-img"></div>
                    <div class="skeleton-card-body">
                        <div class="skeleton-card-title"></div>
                        <div class="skeleton-card-text"></div>
                        <div class="skeleton-card-text"></div>
                        <div class="skeleton-card-text"></div>
                    </div>
                </div>
                
                <div class="skeleton-table">
                    <div class="skeleton-table-head"></div>
                    <div class="skeleton-table-row"></div>
                    <div class="skeleton-table-row"></div>
                    <div class="skeleton-table-row"></div>
                </div>
            </div>
        </div>
    </main>
    
    <script src="../js/accessibility.js"></script>
    <script src="../js/progressive-loading.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize progressive loading
            progressiveLoading.initialize({
                lazyLoadThreshold: 300,
                infiniteScrollThreshold: 300,
                infiniteScrollCallback: loadMoreItems,
                usePaginationReplacement: true,
                paginationSelector: '.pagination',
                loadMoreSelector: '.load-more'
            });
            
            // Manually initialize lazy loading for demo
            initializeLazyLoading();
            
            // Replace pagination with load more button
            replacePaginationWithLoadMore();
            
            // Show content after skeleton loading
            setTimeout(() => {
                document.querySelector('.skeleton-container').innerHTML = `
                    <div class="card">
                        <img src="https://picsum.photos/id/1033/600/400" alt="Product image">
                        <div class="card-body">
                            <h3 class="card-title">Product Title</h3>
                            <p class="card-text">This is a product description. It provides details about the product features and specifications.</p>
                            <button class="btn">View Details</button>
                        </div>
                    </div>
                    
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Price</th>
                                <th>Stock</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Product 1</td>
                                <td>$99.99</td>
                                <td>In Stock</td>
                            </tr>
                            <tr>
                                <td>Product 2</td>
                                <td>$149.99</td>
                                <td>In Stock</td>
                            </tr>
                            <tr>
                                <td>Product 3</td>
                                <td>$199.99</td>
                                <td>Out of Stock</td>
                            </tr>
                        </tbody>
                    </table>
                `;
            }, 2000);
        });
        
        // Initialize lazy loading
        function initializeLazyLoading() {
            // Check if Intersection Observer is supported
            if ('IntersectionObserver' in window) {
                const lazyImageObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const lazyImage = entry.target;
                            const src = lazyImage.dataset.src;
                            
                            if (src) {
                                const img = new Image();
                                img.onload = () => {
                                    lazyImage.src = src;
                                    lazyImage.classList.add('loaded');
                                    
                                    // Hide placeholder
                                    const placeholder = lazyImage.parentNode.querySelector('.lazy-image-placeholder');
                                    if (placeholder) {
                                        placeholder.classList.add('hidden');
                                    }
                                    
                                    // Remove from observer
                                    lazyImageObserver.unobserve(lazyImage);
                                };
                                img.src = src;
                            }
                        }
                    });
                }, {
                    rootMargin: '300px 0px',
                    threshold: 0.01
                });
                
                // Observe all lazy images
                document.querySelectorAll('.lazy-image').forEach(image => {
                    lazyImageObserver.observe(image);
                });
                
                // Progressive image loading
                const progressiveImageObserver = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const fullImage = entry.target;
                            const src = fullImage.dataset.src;
                            
                            if (src) {
                                const img = new Image();
                                img.onload = () => {
                                    fullImage.src = src;
                                    fullImage.classList.add('loaded');
                                    
                                    // Remove from observer
                                    progressiveImageObserver.unobserve(fullImage);
                                };
                                img.src = src;
                            }
                        }
                    });
                }, {
                    rootMargin: '300px 0px',
                    threshold: 0.01
                });
                
                // Observe all progressive images
                document.querySelectorAll('.progressive-image-full').forEach(image => {
                    progressiveImageObserver.observe(image);
                });
            } else {
                // Fallback for browsers that don't support Intersection Observer
                document.querySelectorAll('.lazy-image').forEach(image => {
                    const src = image.dataset.src;
                    if (src) {
                        image.src = src;
                        image.classList.add('loaded');
                        
                        // Hide placeholder
                        const placeholder = image.parentNode.querySelector('.lazy-image-placeholder');
                        if (placeholder) {
                            placeholder.classList.add('hidden');
                        }
                    }
                });
                
                document.querySelectorAll('.progressive-image-full').forEach(image => {
                    const src = image.dataset.src;
                    if (src) {
                        image.src = src;
                        image.classList.add('loaded');
                    }
                });
            }
        }
        
        // Load more items for infinite scroll
        function loadMoreItems() {
            return new Promise((resolve, reject) => {
                // Simulate API call
                setTimeout(() => {
                    const container = document.querySelector('.infinite-scroll-container');
                    
                    if (!container) {
                        reject(new Error('Container not found'));
                        return;
                    }
                    
                    // Get current page from data attribute
                    const currentPage = parseInt(container.dataset.page || '1', 10);
                    const totalPages = parseInt(container.dataset.totalPages || '5', 10);
                    
                    if (currentPage >= totalPages) {
                        resolve({ allLoaded: true });
                        return;
                    }
                    
                    // Clone existing items
                    const items = container.querySelectorAll('.item');
                    const fragment = document.createDocumentFragment();
                    
                    items.forEach((item, index) => {
                        const clone = item.cloneNode(true);
                        const heading = clone.querySelector('h3');
                        if (heading) {
                            heading.textContent = `Item ${(currentPage * items.length) + index + 1}`;
                        }
                        fragment.appendChild(clone);
                    });
                    
                    container.appendChild(fragment);
                    
                    // Update current page
                    container.dataset.page = currentPage + 1;
                    
                    resolve({
                        allLoaded: currentPage + 1 >= totalPages
                    });
                }, 1000);
            });
        }
        
        // Replace pagination with load more button
        function replacePaginationWithLoadMore() {
            const pagination = document.querySelector('.pagination');
            if (!pagination) {
                return;
            }
            
            // Create load more button
            const loadMore = document.createElement('div');
            loadMore.className = 'load-more';
            loadMore.innerHTML = '<button class="btn">Load More</button>';
            
            // Replace pagination with load more button
            pagination.parentNode.replaceChild(loadMore, pagination);
            
            // Add event listener
            loadMore.querySelector('button').addEventListener('click', () => {
                // Show loading indicator
                loadMore.innerHTML = '<div class="infinite-scroll-loader"><div class="loader-spinner"></div><div class="loader-text">Loading more items...</div></div>';
                
                // Simulate loading
                setTimeout(() => {
                    // Add new items
                    const itemsContainer = document.querySelector('.pagination-container .items');
                    const items = itemsContainer.querySelectorAll('.item');
                    const fragment = document.createDocumentFragment();
                    
                    items.forEach((item, index) => {
                        const clone = item.cloneNode(true);
                        const heading = clone.querySelector('h3');
                        if (heading) {
                            heading.textContent = `Product ${items.length + index + 1}`;
                        }
                        fragment.appendChild(clone);
                    });
                    
                    itemsContainer.appendChild(fragment);
                    
                    // Update load more button
                    loadMore.innerHTML = '<button class="btn">Load More</button>';
                    
                    // Add event listener to new button
                    loadMore.querySelector('button').addEventListener('click', () => {
                        loadMore.innerHTML = '<p class="text-center">No more items to load</p>';
                    });
                }, 1500);
            });
        }
    </script>
</body>
</html>
